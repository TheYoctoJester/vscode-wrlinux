{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "options": {
        "env": {
            "SDKROOT": "${config:pokysdk.sdkroot}",
            "SDKTARGETSYSROOT": "${config:pokysdk.sdktargetsysroot}",
            "PATH": "${config:pokysdk.sdkroot}/sysroots/${config:pokysdk.hosttriplet}/usr/bin:${config:pokysdk.sdkroot}/sysroots/${config:pokysdk.hosttriplet}/usr/bin/../${config:pokysdk.hosttriplet}/bin:${config:pokysdk.sdkroot}/sysroots/${config:pokysdk.hosttriplet}/usr/bin/${config:pokysdk.targetarchtriplet}:${config:pokysdk.sdkroot}/sysroots/${config:pokysdk.hosttriplet}/usr/bin/${config:pokysdk.targetarchtriplet}-musl:${env:PATH}",
            "PKG_CONFIG_SYSROOT_DIR": "${config:pokysdk.sdktargetsysroot}",
            "PKG_CONFIG_PATH": "${config:pokysdk.sdktargetsysroot}/usr/lib/pkgconfig:${config:pokysdk.sdktargetsysroot}/usr/share/pkgconfig",
            "CONFIG_SITE": "${config:pokysdk.sdkroot}/site-config-${config:pokysdk.targettriplet}",
            "OECORE_NATIVE_SYSROOT": "${config:pokysdk.sdkroot}/sysroots/${config:pokysdk.hosttriplet}",
            "OECORE_TARGET_SYSROOT": "${config:pokysdk.sdktargetsysroot}",
            "OECORE_ACLOCAL_OPTS": "-I ${config:pokysdk.sdkroot}/sysroots/${config:pokysdk.hosttriplet}/usr/share/aclocal",
            "OECORE_BASELIB": "lib",
            "OECORE_TARGET_ARCH": "arm",
            "OECORE_TARGET_OS": "linux-gnueabi",
            "CC": "${config:pokysdk.targetarchtriplet}-gcc  -mthumb -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a15 -fstack-protector-strong  -O2 -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=${config:pokysdk.sdktargetsysroot}",
            "CXX": "${config:pokysdk.targetarchtriplet}-g++  -mthumb -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a15 -fstack-protector-strong  -O2 -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=${config:pokysdk.sdktargetsysroot}",
            "CPP": "${config:pokysdk.targetarchtriplet}-gcc -E  -mthumb -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a15 -fstack-protector-strong  -O2 -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=${config:pokysdk.sdktargetsysroot}",
            "AS": "${config:pokysdk.targetarchtriplet}-as ",
            "LD": "${config:pokysdk.targetarchtriplet}-ld  --sysroot=${config:pokysdk.sdktargetsysroot}",
            "GDB": "${config:pokysdk.targetarchtriplet}-gdb",
            "STRIP": "${config:pokysdk.targetarchtriplet}-strip",
            "RANLIB": "${config:pokysdk.targetarchtriplet}-ranlib",
            "OBJCOPY": "${config:pokysdk.targetarchtriplet}-objcopy",
            "OBJDUMP": "${config:pokysdk.targetarchtriplet}-objdump",
            "READELF": "${config:pokysdk.targetarchtriplet}-readelf",
            "AR": "${config:pokysdk.targetarchtriplet}-ar",
            "NM": "${config:pokysdk.targetarchtriplet}-nm",
            "M4": "m4",
            "TARGET_PREFIX": "${config:pokysdk.targetarchtriplet}-",
            "CONFIGURE_FLAGS": "--target=${config:pokysdk.targetarchtriplet} --host=${config:pokysdk.targetarchtriplet} --build=x86_64-linux --with-libtool-sysroot=${config:pokysdk.sdktargetsysroot}",
            "CFLAGS": " -O2 -pipe -g -feliminate-unused-debug-types ",
            "CXXFLAGS": " -O2 -pipe -g -feliminate-unused-debug-types ",
            "LDFLAGS": "-Wl,-O1 -Wl,--hash-style=gnu -Wl,--as-needed -Wl,-z,relro,-z,now",
            "CPPFLAGS": "",
            "KCFLAGS": "--sysroot=${config:pokysdk.sdktargetsysroot}",
            "OECORE_DISTRO_VERSION": "${config:pokysdk.distroversion}",
            "OECORE_SDK_VERSION": "${pokysdk.sdkversion}",
            "ARCH": "arm",
            "CROSS_COMPILE": "${config:pokysdk.targetarchtriplet}-"
        }
    },
    "tasks": [
        {
            "label": "Print Environment Variables",
            "type": "shell",
            "command": "printenv",
            "args": [
            ],
            "problemMatcher": [
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": "Poky qemuarm SDK GCC C Compiler",
            "type": "shell",
            "command": "$CC",
            "args": [
                "-g",
                "${CFLAGS}",
                "${file}",
                "-o",
                "${fileDirname}/${fileBasenameNoExtension}"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": "Poky qemuarm SDK Make",
            "type": "shell",
            "command": "make",
            "args": [
                ""
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": "Poky qemuarm SDK Make Target...",
            "type": "shell",
            "command": "make",
            "args": [
                "${input:maketarget}"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
              "kind": "build",
              "isDefault": true
            }            
        },
        {
            "label": "Launch QEMU",
            "type": "shell",
            "windows": {
                // Not tested
                "command": "start -FilePath 'qemu-system-arm' -ArgumentList '-S -gdb tcp::1234 -boot d -cdrom wrlinux.iso -m 512'"
            },
            "linux": {
                "command": "qemu-system-arm -device virtio-net,netdev=net0 -netdev user,id=net0,hostfwd=tcp::1234-:1234 -m 512 -drive file=${config:pokysdk.sdkroot}/core-image-minimal-qemux86-64.ext4,if=virtio,format=raw -cpu kvm64 -enable-kvm -nographic -kernel ${config:pokysdk.sdkroot}/bzImage -append \"root=/dev/vda rw console=ttyS0 console=ttyS0 mem=512M ip=dhcp\""
                //"commond": "qemu-system-arm -device virtio-net-device,netdev=net0,mac=52:54:00:12:35:02 -netdev user,id=net0,hostfwd=tcp::2222-:22,hostfwd=tcp::2323-:23 -object rng-random,filename=/dev/urandom,id=rng0 -device virtio-rng-pci,rng=rng0 -drive file=${config:pokysdk.sdkroot}/core-image-minimal-qemux86-64.ext4,if=none,format=raw -device virtio-blk-device,drive=disk0 -device qemu-xhci -device usb-tablet -device usb-kbd  -machine virt,highmem=off -cpu cortex-a15 -smp 4 -m 256 -serial mon:stdio -serial null -nographic -device VGA,edid=on -kernel /mnt/ephemeral/yplc/build/tmp/deploy/images/qemuarm/zImage--5.13.15+git0+c38435a3ca_482fd531f2-r0-qemuarm-20211018102402.bin -append 'root=/dev/vda rw  mem=256M ip=dhcp console=ttyAMA0 console=hvc0 vmalloc=256
            },
            "problemMatcher": []
        }
    ],
    "inputs": [
        {
          "id": "maketarget",
          "type": "promptString",
          "description": "Make target.",
          "default": "all"
        }
    ]
}
